# Start from the base image used for your ARM builds
FROM arm32v7/ubuntu:latest

# Environment setup
ENV DEBIAN_FRONTEND=noninteractive
ENV RUSTUP_HOME=/usr/local/rust
ENV CARGO_HOME=/usr/local/cargo
ENV PATH=/usr/local/cargo/bin:$PATH

# Install system dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        build-essential \
        gcc-arm-linux-gnueabihf \
        curl \
        git \
        pkg-config \
        libssl-dev \
        ca-certificates \
        python3 \
        python3-dev && \
    update-ca-certificates && \
    rm -rf /var/lib/apt/lists/*

# Install Rust and add ARM target in a single shell
RUN set -eux; \
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | \
        sh -s -- -y --default-toolchain stable; \
    rustup target add armv7-unknown-linux-gnueabihf

# Verify installation (optional)
RUN rustc --version && cargo --version

# Set working directory
WORKDIR /workspace
