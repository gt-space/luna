# Start from the base image used for your ARM builds
FROM arm32v7/ubuntu:latest

# Set environment variables for non-interactive installs
ENV DEBIAN_FRONTEND=noninteractive
ENV RUSTUP_HOME=/usr/local/rust
ENV CARGO_HOME=/usr/local/cargo

# Install all necessary system dependencies in one layer
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        build-essential \
        gcc-arm-linux-gnueabihf \
        curl \
        git \
        pkg-config \
        libssl-dev \
        python3 \
        python3-dev && \
    rm -rf "/var/lib/apt/lists/*"

# Install Rust and the specific target
RUN curl https://sh.rustup.rs -sSf | sh -s -- -y --default-toolchain stable && \
    /usr/local/cargo/bin/rustup target add armv7-unknown-linux-gnueabihf

# Add Cargo to the PATH
ENV PATH=$CARGO_HOME/bin:$PATH

# Set the working directory
WORKDIR /workspace
